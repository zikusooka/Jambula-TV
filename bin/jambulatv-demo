#!/bin/sh

PROJECT_NAME=JambulaTV
SOURCESDIR=/opt
PROJECT_BASE_DIR=$SOURCESDIR/$PROJECT_NAME



clear

# Source functions file
. $PROJECT_BASE_DIR/functions

# Other variables
ASTERISK_DIAL_OUT_NUMBER_1=0776338000
ACTION=$1


case $ACTION in
[Oo][Nn])

# Lights - patch
patch -p1 $BINARY_PREFIX/jambulatv-lights < $PROJECT_PATCHES_DIR/demo.lights.patch

# ZM Alarms - asterisk dialout number
sed -i "s:MY_ASTERISK_DIAL_OUT_NUMBER:$ASTERISK_DIAL_OUT_NUMBER_1:g" $BINARY_PREFIX/jambulatv-zm-alarm-all-notifications

# Re-enable boot splash screen
sed -i "s:GRUB_CMDLINE_LINUX=\"vconsole.font=latarcyrheb-sun16 \":GRUB_CMDLINE_LINUX=\"vconsole.font=latarcyrheb-sun16 rhgb quiet \":g" $GRUB2_DEFAULT_FILE
# Comit grub2 changes
grub2-mkconfig -o $GRUB2_BOOT_FILE

;;

[Oo][Ff][Ff])
# Lights - undo patch
cp -v $PROJECT_BIN_DIR/$SCRIPT/jambulatv-lights $BINARY_PREFIX/

# ZM Alarms - asterisk dialout number
sed -i "s:$ASTERISK_DIAL_OUT_NUMBER_1:MY_ASTERISK_DIAL_OUT_NUMBER:g" $BINARY_PREFIX/jambulatv-zm-alarm-all-notifications

# Remove boot splash screen - for debugging purposes
sed -i "s:GRUB_CMDLINE_LINUX=\"vconsole.font=latarcyrheb-sun16 rhgb quiet \":GRUB_CMDLINE_LINUX=\"vconsole.font=latarcyrheb-sun16 \":g" $GRUB2_DEFAULT_FILE
# Comit grub2 changes
grub2-mkconfig -o $GRUB2_BOOT_FILE

;;

*)
# Usage
cat <<EOF
Usage: $(basename $0) [ON|OFF]
EOF
exit
;;
esac
