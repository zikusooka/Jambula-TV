#!/bin/sh
#
# Jambula Labs @copyright 2020-2021 All rights reserved

ALL_TVSHOW_EXTENSIONS="*[avi|mkv|mp4|m4v]"
COMPLETED_TVSHOWS_DIR=/JambulaTV/Torrents/completed/TV_Shows
REGEX="([sS]([0-9]{2,}|[X]{2,})[eE]([0-9]{2,}|[Y]{2,}))"


#################
#  MAIN SCRIPT  #
#################
for TV_SHOW in $(find $COMPLETED_TVSHOWS_DIR -type f ! -iname "*sample*" -iname "$ALL_TVSHOW_EXTENSIONS");
do
# Set variables
TVSHOW_TITLE=$(basename $TV_SHOW)
TVSHOW_EXT=$(echo $TVSHOW_TITLE | rev | cut -d '.' -f1 | rev)
TVSHOW_DIR=$(basename $(dirname $TV_SHOW))
#
OLD_FILENAME="$TVSHOW_TITLE"
NEW_FILENAME="$(echo $TVSHOW_DIR | sed -e 's:\[:.:g' | sed -e 's:\]:.:g')$TVSHOW_EXT"
#
# See if file matches regex pattern
if [[ ! $TVSHOW_TITLE =~ $REGEX ]]; then
# Rename TV Series
mv -v $COMPLETED_TVSHOWS_DIR/$TVSHOW_DIR/"$OLD_FILENAME" $COMPLETED_TVSHOWS_DIR/$TVSHOW_DIR/"$NEW_FILENAME"
    else
	continue
   fi
done
