#!/bin/sh
# Set variables
JAMBULATV_LOG=/var/log/JambulaTV/messages
KODI_CMD=/usr/bin/kodi
XINIT_CMD=/usr/bin/xinit
LXDM_CMD=/usr/sbin/lxdm 
# See if Intel 828XXX VGA exists 
lspci | grep VGA | grep 'Intel Corporation 828' > /dev/null 2>&1
INTEL_VGA_EXISTS=$?
# if it exists, set environment for VGA cards with no hardware acceleration
if [ "$INTEL_VGA_EXISTS" = "0" ];
then
XBMC_START_ARGS="$XINIT_CMD MESA_GL_VERSION_OVERRIDE=3.0"
else
XBMC_START_ARGS="$XINIT_"
fi

# Export variables
export DISPLAY=:0.0
export TERM=xterm
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/usr/bin:/bin:/usr/local/bin:/usr/X11R6/bin/:/sbin:/usr/sbin
export 



#################
#  MAIN SCRIPT  #
#################
case $@ in

# KODI
kodi)
# Pre-settings for kodi
echo "$(date): JambulaTV started" > $JAMBULATV_LOG

# Start kodi using xinit
$XBMC_START_ARGS $KODI_CMD
;;

# LXDE
lxde)
$LXDM_CMD
;;

*)
clear
echo "Usage: $(basename $0) \
[kodi|lxde]
NOTE: This script should really not be run alone.  See jambulatv@.service"
;;

esac
