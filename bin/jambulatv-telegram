#!/bin/sh
TELEGRAM_METHOD_NAME=$1
TELEGRAM_API_BOT=$2
TELEGRAM_MESSAGE="$3"
CHAT_ID=$4
TELEGRAM_API_URL="https://api.telegram.org"


# Functions
# ---------
#
usage () {
clear
if [ "x$TELEGRAM_METHOD_NAME" = "x" ];
then
echo "Usage:  ./`basename $0` [METHOD] [TELEGRAM_API_BOT] [TELEGRAM_MESSAGE] [CHAT_ID (Optional)]
"
exit 1

elif [ "x$TELEGRAM_API_BOT" = "x" ];
then
echo "Usage:  ./`basename $0` [METHOD] [TELEGRAM_API_BOT] [TELEGRAM_MESSAGE] [CHAT_ID (Optional)]
"
exit 1

elif [ "x$TELEGRAM_MESSAGE" = "x" ];
then
echo "Usage:  ./`basename $0` [METHOD] [TELEGRAM_API_BOT] [TELEGRAM_MESSAGE] [CHAT_ID (Optional)]
"
exit 1

fi
}

# Chat ID
get_chat_id () {
TELEGRAM_CHAT_ID=$(curl -s -X POST $TELEGRAM_API_URL/bot$TELEGRAM_API_BOT/getUpdates | jq . | grep \"id\": | sort -u | head -1 | awk {'print $2'})
if [ "x$TELEGRAM_CHAT_ID" = "x" ];
then
TELEGRAM_CHAT_ID=$CHAT_ID
fi
}

# Send
send_message () {
curl -s -X POST $TELEGRAM_API_URL/bot$TELEGRAM_API_BOT/sendMessage \
	-d text="$TELEGRAM_MESSAGE" -d chat_id=$TELEGRAM_CHAT_ID > /dev/null 2>&1
}


# Main Script
# -----------
#
case $TELEGRAM_METHOD_NAME in
[Ss][Ee][Nn][Dd][Mm][Ee][Ss][Ss][Aa][Gg][Ee])
get_chat_id 
send_message
;;
*)
usage
;;
esac
