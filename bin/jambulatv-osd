#!/usr/bin/env python
# Display Announcements on JambulaTV Screen
#
# Variables
TIME = 15000  # ms
ICON = "jambulatv-logo.png"
KODI_GUI_SETTINGS="/JambulaTV/.xbmc/userdata/guisettings.xml"

# Import modules
import sys
import argparse
import os
import warnings
from xbmcjson import XBMC, PLAYER_VIDEO
import xml.etree.ElementTree as ET

__author__ = 'Joseph Zikusooka.  Jambula Labs @copyright 2015-2016 All rights reserved'

# Parse arguments/ message
parser = argparse.ArgumentParser(description='Display Announcements on JambulaTV Screen')
parser.add_argument('-m','--message', help='The message you want displayed.  Wrap it in quotes',required=True)
args = parser.parse_args()

 
# Message
MESSAGE = args.message
# Get Kodi web server variables
tree = ET.parse(KODI_GUI_SETTINGS)
root = tree.getroot()
for services in root.findall('services'):
   USERNAME = services.find('webserverusername').text
   PASSWORD = services.find('webserverpassword').text
   HTTP_PORT = services.find('webserverport').text
   TITLE = services.find('devicename').text
# HTTP URL
HTTP_URL = "http://127.0.0.1:" + HTTP_PORT + "/jsonrpc"



#Login with custom credentials
xbmc = XBMC(HTTP_URL, USERNAME, PASSWORD)

# Ignore urllib2.py UserWarning: Basic Auth Realm was unquoted url, req, headers
warnings.filterwarnings("ignore", category=UserWarning, module='urllib2')

# Display message on screen
xbmc.GUI.ShowNotification({'title':TITLE, 'message':MESSAGE, 'displaytime':TIME, 'image':ICON})
