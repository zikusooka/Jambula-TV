;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;  AEx Home Automation Dialplan  ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[globals](+)
TV_RECORDING_START_SCRIPT = /usr/bin/jambulatv-kodi-controller
TV_RECORDING_STOP_SCRIPT = /usr/bin/jambulatv-kodi-controller
LIGHTS_ON_COMMAND = "/usr/bin/jambulatv-lights 'Living Room' On"
LIGHTS_OFF_COMMAND = "/usr/bin/jambulatv-lights 'Living Room' Off"


[aexhome-automation]
; Welcome and authentication
exten => 5555,1,agi(jambulatv-tts.agi,"Welcome to Jamboolah TV Home Automation ... Please enter your access code now")
exten => 5555,n,Authenticate(1234,,4,silence/1)
; Authenticate(password[,options[,maxdigits[,prompt]]])

; Menu of options
exten => 5555,n,agi(jambulatv-tts.agi,"To turn lights on, press 6 .. To turn lights off, press 7 .. To record a TV channel, press 8 .. To stop recording a TV channel, press 80 .. To log in to voice mail, press 9 .. For a quick status report, press 10 .. To request for a wakeup call, press 11 ..  For the weather report, press 12"
exten => 5555,n(ha_menu),Read(HA_MENU_SELECTED,,2,,,)
;Read(variable[,filename[&filename2[&...]][,maxdigits[,options[,attempts[,timeout]]]]])

exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "6" ]?lights-on,5600,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "7" ]?lights-off,5610,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "8" ]?tv-recording-menu,5611,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "9" ]?voicemail-check,5612,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "80" ]?tv-recording-cancel,5614,1)



;;;;;;;;;;;;;;
;;  Lights  ;;
;;;;;;;;;;;;;;
;
[lights-on]
exten => 5600,1,System(${LIGHTS_ON_COMMAND})
exten => 5600,n,BackGround(ha/lights&ha/on)
exten => 5600,n,BackGround(goodbye)
exten => 5600,n,Hangup()

[lights-off]
exten => 5610,1,System(${LIGHTS_OFF_COMMAND})
exten => 5610,n,Wait(3)
exten => 5610,n,BackGround(ha/lights&ha/off)
exten => 5610,n,BackGround(goodbye)
exten => 5610,n,Hangup()



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  TV Channel Selection Menu  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
[tv-recording-menu]
exten => 5611,1,agi(jambulatv-tts.agi,"Please choose the TV channel you want to record as follows")
exten => 5611,n(tv_menu),agi(jambulatv-tts.agi,"For U B C Press One .. For STAR TV Press Two .. For N B S Press Three .. For BOOK EH DAY Press Four .. For L TV Press Five .. For Quezi Sports Press Six .. For TOP TV Press Seven .. For URBAN TV Press Eight .. For DELTA TV Press Nine .. For SALT TV Press Ten .. For RECORD TV Press Eleven .. For C C TV Press Twelve .. For CHANNEL FOURTY FOUR Press Thirteen .. For N TV Press Fourteen")
exten => 5611,n,Read(TV_CHANNEL_SELECTED,,2,,,)

exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "1" ]?tv-channel-settings,CHANNEL_01,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "2" ]?tv-channel-settings,CHANNEL_02,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "3" ]?tv-channel-settings,CHANNEL_03,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "4" ]?tv-channel-settings,CHANNEL_04,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "5" ]?tv-channel-settings,CHANNEL_05,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "6" ]?tv-channel-settings,CHANNEL_06,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "7" ]?tv-channel-settings,CHANNEL_07,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "8" ]?tv-channel-settings,CHANNEL_08,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "9" ]?tv-channel-settings,CHANNEL_09,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "10" ]?tv-channel-settings,CHANNEL_10,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "11" ]?tv-channel-settings,CHANNEL_11,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "12" ]?tv-channel-settings,CHANNEL_12,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "13" ]?tv-channel-settings,CHANNEL_13,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "14" ]?tv-channel-settings,CHANNEL_14,1)



;;;;;;;;;;;;;;;;;
;;  Voicemail  ;;
;;;;;;;;;;;;;;;;;
;
[voicemail-check]
exten => 5612,1,Wait(3)
exten => 5612,n,VoicemailMain(${VMAIL_HOME},sa)
exten => 5612,n,Hangup()



;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  Cancel TV Recordings  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
[tv-recording-cancel]
exten => 5614,1,System(${TV_RECORDING_STOP_SCRIPT} tv_record_stop &)
exten => 5614,n,NoOp(**** ${TV_RECORDING_STOP_SCRIPT} tv_record_stop &)
exten => 5614,n,System(${TV_RECORDING_STOP_SCRIPT} tv_play_stop &)
exten => 5614,n,agi(jambulatv-tts.agi,"Recording Stopped")
exten => 5614,n,BackGround(goodbye)
exten => 5614,n,Hangup()



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  ZoneMinder Alarm Calls  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
[zm-alarm-call]
exten => 5615,1,NoOp(**** Hello. This is an alert from Jam Boolah TV. Motion Was Detected by Camera No.${CAM_ID} also known as ${CAM_NAME} at ${CAM_TIME}.  The Video of this Event has been logged and the event ID is: ${CAM_EVENT} ****)
exten => 5615,n,agi(jambulatv-tts.agi,"Hello. This is an alert from Jam Boolah TV.  Motion Was Detected by Camera No.${CAM_ID}, also known as ${CAM_NAME} at ${CAM_TIME}.  The Video of this Event has been logged and the event ID is: ${CAM_EVENT}")
exten => 5615,n,agi(jambulatv-tts.agi,"Good Bye")
exten => 5615,n,Hangup()



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  Invalid Input and Timeout rules  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; If invalid input is recieved
exten => i,1,Playback(pbx-invalid)
exten => i,n,GoTo(aexhome-automation,5555,ha_menu)
; If timeout is reached
;exten => t,1,GoTo(aexhome-automation,5555,ha_menu)
exten => t,1,Hangup()






;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  TV Channel Settings  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
[tv-channel-settings]
; UBC
exten => CHANNEL_01,1,Set(STATION=UBC)
exten => CHANNEL_01,n,Set(CHANNEL_NAME="UBC TV")
exten => CHANNEL_01,n,GoTo(tv-recording-duration,5700,1)
; STAR 
exten => CHANNEL_02,1,Set(STATION=STAR)
exten => CHANNEL_02,n,Set(CHANNEL_NAME="UBC STAR TV")
exten => CHANNEL_02,n,GoTo(tv-recording-duration,5700,1)
; NBS
exten => CHANNEL_03,1,Set(STATION=NBS)
exten => CHANNEL_03,n,Set(CHANNEL_NAME="NBS TV")
exten => CHANNEL_03,n,GoTo(tv-recording-duration,5700,1)
; BUKEDDE
exten => CHANNEL_04,1,Set(STATION=BUKEDDE)
exten => CHANNEL_04,n,Set(CHANNEL_NAME="BUKEDDE TV1")
exten => CHANNEL_04,n,GoTo(tv-recording-duration,5700,1)
; LTV
exten => CHANNEL_05,1,Set(STATION=LTV)
exten => CHANNEL_05,n,Set(CHANNEL_NAME="LIGHTHOUSE TV")
exten => CHANNEL_05,n,GoTo(tv-recording-duration,5700,1)
; WBS
exten => CHANNEL_06,1,Set(STATION=WBS)
exten => CHANNEL_06,n,Set(CHANNEL_NAME="WBS TV")
exten => CHANNEL_06,n,GoTo(tv-recording-duration,5700,1)
; TOPTV
exten => CHANNEL_07,1,Set(STATION=TOPTV)
exten => CHANNEL_07,n,Set(CHANNEL_NAME="TOP TV")
exten => CHANNEL_07,n,GoTo(tv-recording-duration,5700,1)
; URBAN
exten => CHANNEL_08,1,Set(STATION=URBAN)
exten => CHANNEL_08,n,Set(CHANNEL_NAME="URBAN TV")
exten => CHANNEL_08,n,GoTo(tv-recording-duration,5700,1)
; DELTA
exten => CHANNEL_09,1,Set(STATION=DELTA)
exten => CHANNEL_09,n,Set(CHANNEL_NAME="DELTA TV")
exten => CHANNEL_09,n,GoTo(tv-recording-duration,5700,1)
; SALT
exten => CHANNEL_10,1,Set(STATION=SALT)
exten => CHANNEL_10,n,Set(CHANNEL_NAME="SALT TV")
exten => CHANNEL_10,n,GoTo(tv-recording-duration,5700,1)
; RECORD
exten => CHANNEL_11,1,Set(STATION=RECORDTV)
exten => CHANNEL_11,n,Set(CHANNEL_NAME="RECORD TV")
exten => CHANNEL_11,n,GoTo(tv-recording-duration,5700,1)
; SPORTS
exten => CHANNEL_12,1,Set(STATION=CCTV)
exten => CHANNEL_12,n,Set(CHANNEL_NAME=CCTV)
exten => CHANNEL_12,n,GoTo(tv-recording-duration,5700,1)
; CHAN44
exten => CHANNEL_13,1,Set(STATION=CHAN44)
exten => CHANNEL_13,n,Set(CHANNEL_NAME="MIRACLE TV")
exten => CHANNEL_13,n,GoTo(tv-recording-duration,5700,1)
; NTV
exten => CHANNEL_14,1,Set(STATION=NTV)
exten => CHANNEL_14,n,Set(CHANNEL_NAME="N TV")
exten => CHANNEL_14,n,GoTo(tv-recording-duration,5700,1)



; Ask for TV Length of time
;;;;;;;;;;;;;;;;;;;;;;;;;;;;
[tv-recording-duration]
exten => 5700,1,agi(jambulatv-tts.agi,"For 30 minutes, press 1 .. For 1 hour, press 2 .. For 1 and a half hours, press 3 .. For 2 hours, press 4 .. For 2 and a half hours, press 5 .. For 3 hours, press 6")

exten => 5700,n,Read(LENGTH_OF_SHOW)

exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "1"]?5701,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "2"]?5702,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "3"]?5703,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "4"]?5704,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "5"]?5705,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "6"]?5706,1)

; Set duration & Proceed to recording
exten => 5701,1,Set(DURATION=1800)
exten => 5701,n,Set(SAY_LENGTH="30 minutes")
exten => 5701,n,GoTo(tv-recording-start,5710,1)

exten => 5702,1,Set(DURATION=3600)
exten => 5702,n,Set(SAY_LENGTH=1 hour)
exten => 5702,n,GoTo(tv-recording-start,5710,1)

exten => 5703,1,Set(DURATION=5400)
exten => 5703,n,Set(SAY_LENGTH=1-and-a-half-hours)
exten => 5703,n,GoTo(tv-recording-start,5710,1)

exten => 5704,1,Set(DURATION=7200)
exten => 5704,n,Set(SAY_LENGTH=2-hours)
exten => 5704,n,GoTo(tv-recording-start,5710,1)

exten => 5705,1,Set(DURATION=9000)
exten => 5705,n,Set(SAY_LENGTH=2-and-a-half-hours)
exten => 5705,n,GoTo(tv-recording-start,5710,1)

exten => 5706,1,Set(DURATION=10800)
exten => 5706,n,Set(SAY_LENGTH=3-hours)
exten => 5706,n,GoTo(tv-recording-start,5710,1)



[tv-recording-start]
exten => 5710,1,agi(jambulatv-tts.agi,"You have chosen to record ${CHANNEL_NAME} for ${SAY_LENGTH}, To proceed with ${CHANNEL_NAME} press One, To Cancel ${CHANNEL_NAME} press Zero")
exten => 5710,n,Read(TV_ACTION_SELECTED,silent/1,2,,,)
;Read(variable[,filename[&filename2[&...]][,maxdigits[,options[,attempts[,timeout]]]]])
exten => 5710,n,GoToIf($[ "${TV_ACTION_SELECTED}" = "1" ]?5711,1)
exten => 5710,n,GoToIf($[ "${TV_ACTION_SELECTED}" = "0" ]?5712,1)

exten => 5711,1,System(${TV_RECORDING_START_SCRIPT} tv_record_start ${CHANNEL_NAME} ${DURATION} &)
exten => 5711,n,NoOp(**** ${TV_RECORDING_START_SCRIPT} tv_record_start ${CHANNEL_NAME} ${DURATION} &)
exten => 5711,n,System(${TV_RECORDING_START_SCRIPT} tv_play_start ${CHANNEL_NAME} ${DURATION} &)
exten => 5711,n,agi(jambulatv-tts.agi,"Started recording ${CHANNEL_NAME}")
exten => 5711,n,BackGround(goodbye)
exten => 5711,n,Hangup()

exten => 5712,1,agi(jambulatv-tts.agi,"Cancelled recording of ${CHANNEL_NAME}")
exten => 5712,n,GoTo(tv-recording-menu,5611,tv_menu)

;If invalid input is recieved
exten => i,1,Playback(pbx-invalid)
exten => i,n,GoTo(tv-recording-menu,5611,tv_menu)
;
; A timeout rule
exten => t,1,GoTo(tv-recording-menu,5611,tv_menu)
;exten => t,1,Hangup()
