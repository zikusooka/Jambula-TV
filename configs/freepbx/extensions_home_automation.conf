;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;  AEx Home Automation Dialplan  ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

[globals](+)
TV_RECORDING_START_SCRIPT = /diskA/equator/scripts/recording/tv/record_tv.sh
TV_RECORDING_STOP_SCRIPT = /diskA/equator/scripts/recording/tv/stop_record_tv.sh


[aexhome-automation]
exten => 5555,1,Authenticate(1234,,4,welcome&silence/1&ha/to-control-lights-appl&please-enter-your&access-code&now)
; Authenticate(password[,options[,maxdigits[,prompt]]])


;exten => 5555,n(ha_menu),Background(for&ha/lights&ha/on&press-6&silence/1)
;exten => 5555,n,Background(for&ha/lights&ha/off&press-7&silence/1)
;exten => 5555,n,Background(for&vm-torerecord&press-8&silence/1)
;exten => 5555,n,BackGround(to-log-in-to-voice-mail&press-9&silence/1)
;exten => 5555,n,BackGround(for&turn-off-recording&press&digits/80&silence/1)

;exten => 5555,n,BackGround(ha/for-quick-status-report&press&digits/10&silence/1)
;exten => 5555,n,BackGround(for-a-daily-wakeup-call&press&digits/11&silence/1)
;exten => 5555,n,BackGround(for-the-weather&press&digits/12&silence/1)

;exten => 5555,n,Read(HA_MENU_SELECTED,please-enter-your&digits&followed-by&hash,,,,)

exten => 5555,n(ha_menu),Read(HA_MENU_SELECTED,available-options&silence/1&BREAK&for&ha/lights&ha/on&press-6&silence/1&BREAK&for&ha/lights&ha/off&press-7&silence/1&BREAK&for&dictate/record&ha/on&press-8&silence/1&BREAK&to-log-in-to-voice-mail&press-9&silence/1&BREAK&dictate/record&ha/off&press&digits/80&silence/1&BREAK&ha/for-quick-status-report&press&digits/10&silence/1&BREAK&for-a-daily-wakeup-call&press&digits/11&silence/1&BREAK&for-the-weather&press&digits/12&silence/1&BREAK&please-enter-your&digits&followed-by&hash,2,,,)

;Read(variable[,filename[&filename2[&...]][,maxdigits[,options[,attempts[,timeout]]]]])

exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "6" ]?lights-on,5600,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "7" ]?lights-off,5610,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "8" ]?tv-recording-menu,5611,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "9" ]?voicemail-check,5612,1)
exten => 5555,n,GoToIf($[ "${HA_MENU_SELECTED}" = "80" ]?tv-recording-cancel,5614,1)



;;;;;;;;;;;;;;
;;  Lights  ;;
;;;;;;;;;;;;;;
;
[lights-on]
exten => 5600,1,System(/usr/local/bin/heyu lightson A)
exten => 5600,n,BackGround(ha/lights&ha/on)
exten => 5600,n,BackGround(goodbye)
exten => 5600,n,Hangup()

[lights-off]
exten => 5610,1,System(/usr/local/bin/heyu off lightsoff A)
exten => 5610,n,BackGround(ha/lights&ha/off)
exten => 5610,n,BackGround(goodbye)
exten => 5610,n,Hangup()



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  TV Channel Selection Menu  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
[tv-recording-menu]
exten => 5611,1,Swift(Recording TV Program)

exten => 5611,n(tv_menu),Swift(U B C Press One)
exten => 5611,n,Swift(STAR TV Press Two)
exten => 5611,n,Swift(N B S Press Three)
exten => 5611,n,Swift(BOOK A DAY Press Four)
exten => 5611,n,Swift(L TV Press Five)
exten => 5611,n,Swift(W B S Press Six)
exten => 5611,n,Swift(TOP TV Press Seven)
exten => 5611,n,Swift(E A TV Press Eight)
exten => 5611,n,Swift(CITIZEN Press Nine)
exten => 5611,n,Swift(I TV Press Ten)
exten => 5611,n,Swift(RECORD TV Press Eleven)
exten => 5611,n,Swift(SPORTS TV Press Twelve)
exten => 5611,n,Swift(CHANNEL FOURTY FOUR Press Thirteen)
exten => 5611,n,Swift(N TV Press Fourteen)

exten => 5611,n,Read(TV_CHANNEL_SELECTED,please-enter-your&digits&followed-by&hash,2,,,)

exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "1" ]?tv-channel-settings,CHANNEL_01,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "2" ]?tv-channel-settings,CHANNEL_02,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "3" ]?tv-channel-settings,CHANNEL_03,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "4" ]?tv-channel-settings,CHANNEL_04,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "5" ]?tv-channel-settings,CHANNEL_05,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "6" ]?tv-channel-settings,CHANNEL_06,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "7" ]?tv-channel-settings,CHANNEL_07,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "8" ]?tv-channel-settings,CHANNEL_08,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "9" ]?tv-channel-settings,CHANNEL_09,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "10" ]?tv-channel-settings,CHANNEL_10,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "11" ]?tv-channel-settings,CHANNEL_11,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "12" ]?tv-channel-settings,CHANNEL_12,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "13" ]?tv-channel-settings,CHANNEL_13,1)
exten => 5611,n,GoToIf($[ "${TV_CHANNEL_SELECTED}" = "14" ]?tv-channel-settings,CHANNEL_14,1)



;;;;;;;;;;;;;;;;;
;;  Voicemail  ;;
;;;;;;;;;;;;;;;;;
;
[voicemail-check]
exten => 5612,1,Wait(3)
exten => 5612,n,VoicemailMain(${VMAIL_HOME},sa)
exten => 5612,n,Hangup()



;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  Cancel TV Recordings  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
[tv-recording-cancel]
exten => 5614,1,AGI(${TV_RECORDING_STOP_SCRIPT})
exten => 5614,n,Swift(Recording Stopped)
exten => 5614,n,BackGround(goodbye)
exten => 5614,n,Hangup()



;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  Invalid Input and Timeout rules  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
; If invalid input is recieved
exten => i,1,Playback(pbx-invalid)
exten => i,n,GoTo(aexhome-automation,5555,ha_menu)
; If timeout is reached
;exten => t,1,GoTo(aexhome-automation,5555,ha_menu)
exten => t,1,Hangup()






;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  TV Channel Settings  ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;
[tv-channel-settings]
; UBC
exten => CHANNEL_01,1,Set(STATION=UBC)
exten => CHANNEL_01,n,Set(CHANNEL_NO=5)
exten => CHANNEL_01,n,GoTo(tv-recording-duration,5700,1)
; STAR 
exten => CHANNEL_02,1,Set(STATION=STAR)
exten => CHANNEL_02,n,Set(CHANNEL_NO=7)
exten => CHANNEL_02,n,GoTo(tv-recording-duration,5700,1)
; NBS
exten => CHANNEL_03,1,Set(STATION=NBS)
exten => CHANNEL_03,n,Set(CHANNEL_NO=12)
exten => CHANNEL_03,n,GoTo(tv-recording-duration,5700,1)
; BUKEDDE
exten => CHANNEL_04,1,Set(STATION=BUKEDDE)
exten => CHANNEL_04,n,Set(CHANNEL_NO=13)
exten => CHANNEL_04,n,GoTo(tv-recording-duration,5700,1)
; LTV
exten => CHANNEL_05,1,Set(STATION=LTV)
exten => CHANNEL_05,n,Set(CHANNEL_NO=22)
exten => CHANNEL_05,n,GoTo(tv-recording-duration,5700,1)
; WBS
exten => CHANNEL_06,1,Set(STATION=WBS)
exten => CHANNEL_06,n,Set(CHANNEL_NO=25)
exten => CHANNEL_06,n,GoTo(tv-recording-duration,5700,1)
; TOPTV
exten => CHANNEL_07,1,Set(STATION=TOPTV)
exten => CHANNEL_07,n,Set(CHANNEL_NO=28)
exten => CHANNEL_07,n,GoTo(tv-recording-duration,5700,1)
; EATV
exten => CHANNEL_08,1,Set(STATION=EATV)
exten => CHANNEL_08,n,Set(CHANNEL_NO=31)
exten => CHANNEL_08,n,GoTo(tv-recording-duration,5700,1)
; CITIZEN
exten => CHANNEL_09,1,Set(STATION=CITIZEN)
exten => CHANNEL_09,n,Set(CHANNEL_NO=32)
exten => CHANNEL_09,n,GoTo(tv-recording-duration,5700,1)
; ITV
exten => CHANNEL_10,1,Set(STATION=ITV)
exten => CHANNEL_10,n,Set(CHANNEL_NO=34)
exten => CHANNEL_10,n,GoTo(tv-recording-duration,5700,1)
; RECORD
exten => CHANNEL_11,1,Set(STATION=RECORDTV)
exten => CHANNEL_11,n,Set(CHANNEL_NO=42)
exten => CHANNEL_11,n,GoTo(tv-recording-duration,5700,1)
; SPORTS
exten => CHANNEL_12,1,Set(STATION=SPORTSTV)
exten => CHANNEL_12,n,Set(CHANNEL_NO=43)
exten => CHANNEL_12,n,GoTo(tv-recording-duration,5700,1)
; CHAN44
exten => CHANNEL_13,1,Set(STATION=CHAN44)
exten => CHANNEL_13,n,Set(CHANNEL_NO=44)
exten => CHANNEL_13,n,GoTo(tv-recording-duration,5700,1)
; NTV
exten => CHANNEL_14,1,Set(STATION=NTV)
exten => CHANNEL_14,n,Set(CHANNEL_NO=54)
exten => CHANNEL_14,n,GoTo(tv-recording-duration,5700,1)






; Ask for TV Length of time
;;;;;;;;;;;;;;;;;;;;;;;;;;;;
[tv-recording-duration]

exten => 5700,1,Read(LENGTH_OF_SHOW,for&digits/30&minutes&press-1&silence/1&BREAK&for&digits/1&hours&press-2&silence/1&&for&digits/1&and&a&half&hours&press-3&silence/1&for&digits/2&hours&press-4&silence/1,)

exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "1"]?5701,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "2"]?5702,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "3"]?5703,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "4"]?5704,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "5"]?5705,1)
exten => 5700,n,GoToIf( $["${LENGTH_OF_SHOW}" = "6"]?5706,1)

; Set duration & Proceed to recording
exten => 5701,1,Set(DURATION=1800)
exten => 5701,n,Set(SAY_LENGTH=digits/30&minutes)
exten => 5701,n,GoTo(tv-recording-start,5710,1)

exten => 5702,1,Set(DURATION=3600)
exten => 5702,n,Set(SAY_LENGTH=digits/1&hours)
exten => 5702,n,GoTo(tv-recording-start,5710,1)

exten => 5703,1,Set(DURATION=5400)
exten => 5703,n,Set(SAY_LENGTH=digits/1&and&half&hours)
exten => 5703,n,GoTo(tv-recording-start,5710,1)

exten => 5704,1,Set(DURATION=7200)
exten => 5704,n,Set(SAY_LENGTH=digits/2&hours)
exten => 5704,n,GoTo(tv-recording-start,5710,1)

exten => 5705,1,Set(DURATION=9000)
exten => 5705,n,Set(SAY_LENGTH=digits/2&and&half&hours)
exten => 5705,n,GoTo(tv-recording-start,5710,1)

exten => 5706,1,Set(DURATION=10800)
exten => 5706,n,Set(SAY_LENGTH=digits/3&hours)
exten => 5706,n,GoTo(tv-recording-start,5710,1)



[tv-recording-start]
exten => 5710,1,Swift(You have chosen to record ${STATION} for ${SAY_LENGTH})
exten => 5710,n,Swift(To proceed with ${STATION} press One)
exten => 5710,n,Swift(To Cancel ${STATION} press Zero)

exten => 5710,n,Read(TV_ACTION_SELECTED,please-enter-your&digits&followed-by&hash,,,,)

exten => 5710,n,GoToIf($[ "${TV_ACTION_SELECTED}" = "1" ]?5711,1)
exten => 5710,n,GoToIf($[ "${TV_ACTION_SELECTED}" = "0" ]?5712,1)

;exten => 5711,1,AGI(${TV_RECORDING_START_SCRIPT},${CHANNEL_NO},${DURATION})

exten => 5711,1,System(${TV_RECORDING_START_SCRIPT} ${CHANNEL_NO} ${DURATION} &)
exten => 5711,n,NoOp(**** ${TV_RECORDING_START_SCRIPT} ${CHANNEL_NO} ${DURATION} &)

exten => 5711,n,Swift(Started recording ${STATION})
exten => 5711,n,BackGround(goodbye)
exten => 5711,n,Hangup()

exten => 5712,1,Swift(Cancelled recording of ${STATION})
exten => 5712,n,GoTo(tv-recording-menu,5611,tv_menu)

;If invalid input is recieved
exten => i,1,Playback(pbx-invalid)
exten => i,n,GoTo(tv-recording-menu,5611,tv_menu)
;
; A timeout rule
exten => t,1,GoTo(tv-recording-menu,5611,tv_menu)
;exten => t,1,Hangup()
