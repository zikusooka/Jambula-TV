motion_detected_outside_make_noise:
  sequence:


    # Start capture of snapshot
    # --------------------------
    #
    # Arm camera alarm
    - service: shell_command.zoneminder_camera_arm
      data_template:
        camera_id: !secret zoneminder_camera_001


    # Generate voice files
    # --------------------
    # Merge audio files
    - service: shell_command.ffmpeg_concat_two_mp3
      data_template:
        input_directory: !secret jambulatv_sounds_dir
        input_file1: 'chime_small.mp3'
        input_file2: 'attention-motion-detected-02.mp3'
        output_directory: !secret jambulatv_temp_dir
        output_file: 'sound_effect_attention_motion_detected.mp3'


    # Wait until voice alerts mixer status is 'off'
    # ---------------------------------------------
    - service: script.wait_for_availability_of_mixer_voice_alerts


    # Set status of voice alerts mixer to 'on'
    # ----------------------------------------
    - service: homeassistant.turn_on
      data:
        entity_id: input_boolean.voice_alerts_mixer_status


    # Voice Alert: Announce that motion was detected
    # -----------------------------------------------
    # a) Run script: If music is playing, pause it - player
    - service: script.music_pause_if_playing

    # b) Play merged audio file in temp directory using house speakers
    - service: shell_command.voice_alerts_and_sound_effects
      data_template:
        sound_alert: 'sound_effect_attention_motion_detected'
        audio_gain: !secret voice_alert_audio_gain_high

    # c) Run script: If music is paused, unpause player - player
    - service: script.music_unpause_if_paused


    # Set status of voice alerts mixer to 'off'
    # ----------------------------------------
    - service: homeassistant.turn_off
      data:
        entity_id: input_boolean.voice_alerts_mixer_status


    # Stop capture of snapshot
    # -------------------------
    # 
    # Make alarm at local server station
    - service: shell_command.beep_alerts_at_local_server


    # Stop capture of snapshot
    # -------------------------
    #
    # a) Wait a bit
    - delay: '00:00:45'

    # b) Disarm camera alarm
    - service: shell_command.zoneminder_camera_disarm
      data_template:
        camera_id: !secret zoneminder_camera_001


    # Other examples
    # --------------
    # 
    # Make noise - Beeps
    #- service: shell_command.play_alert_at_remote_workstation
    #  data_template:
    #    ssh_username: !secret operator_001_ssh_username
    #    ssh_host: !secret operator_001_ssh_host
    #    alert_command: "/usr/bin/aplay /usr/share/sounds/purple/alert.wav /usr/share/sounds/purple/alert.wav /usr/share/sounds/purple/alert.wav ; /usr/bin/gxmessage -center -ontop -sticky -timeout 20 -title Motion-detected Motion-detected-outside"
      # Try this alarm for loud noise
      #/usr/share/tuxtype/sounds/alarm.wav
