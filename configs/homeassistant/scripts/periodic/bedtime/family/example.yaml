bedtime_zik:
  sequence:


  # 1. Say bedtime greeting for zik
  # -------------------------------
  
    # a) Merge audio files
    - service: shell_command.ffmpeg_concat_two_mp3
      data_template:
        input_directory: !secret jambulatv_sounds_dir
        input_file1: 'hello.mp3'
        input_file2: 'zik.mp3'
        output_directory: !secret jambulatv_temp_dir
        output_file: 'greet_zik.mp3'

    # b) Mute speaker volume if there is already audio playing
    - service: shell_command.speaker_volume_mute
    # Pause for a second - DO NOT REMOVE unless you have a fix!
    - delay: '00:00:01'

    # c) Play merged audio file using house speakers
    - service: shell_command.play_merged_audio_file
      data_template:
        merged_audio_dir: !secret jambulatv_temp_dir
        merged_audio_file: 'hello_zik.mp3'

    # d) Unmute speaker volume 
    - service: shell_command.speaker_volume_unmute


  # 2. Text weather reports
  # ------------------------

    # a) WhatsApp
    - service: script.send_whatsapp
      data_template:
        whatsapp_text: !include ../../../../templates/weather/daily_report_notification_message.yaml
        whatsapp_image: ''
        whatsapp_recipient_phone: ''

    # b) Telegram
    - service: script.send_telegram
      data_template: 
        telegram_text: !include ../../../../templates/weather/daily_report_notification_message.yaml
        telegram_image: ''
        telegram_recipient_phone: ''


  # 3. Backup up remote PC i.e. Laptop
  # ----------------------------------

    - service: shell_command.backup_remote_pc_data_2_usb_disk


  # 4. Shutdown this system
  # -----------------------
  
    # a) Set wake up time before shutting down system
    - service: shell_command.set_wakeup_and_shutdown_via_rtcwake
      data_template:
        alarm_time: "{{states('sensor.phone_alarm_for_zik_tecno')}}"

    # Delay 15 minutes before shutdown to allow notifications to go out
    - delay: '00:15:00'
