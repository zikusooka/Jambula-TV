alias: Militarize house while away
initial_state: True


trigger:

  - platform: state
    entity_id: person.eva
    to: 'Away'


condition:
  condition: and
  conditions:

    # Laptop at Kampala is turned off?
    - condition: state
      entity_id: 'device_tracker.kampala'
      state: 'Away'

    # Last triggered more than 5 minute(s) ago
    - condition: template
      value_template: '{{ (as_timestamp(now()) - as_timestamp(states.person.eva.attributes.last_triggered | default(0)) | int > 300)}}'


action:

  - service: shell_command.zoneminder_camera_arm
    data_template:
      camera_id: !secret zoneminder_camera_001
