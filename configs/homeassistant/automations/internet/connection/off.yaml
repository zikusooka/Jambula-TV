alias: Internet is off
initial_state: True

trigger:

  - platform: state
    entity_id: binary_sensor.internet
    from: 'on'
    to: 'off'
    for: '00:05:00'

condition:
  condition: and
  conditions:

    # If Internet is still off
    - condition: template
      value_template: "{{ is_state('binary_sensor.internet', 'off') }}"

    # Someone at home
    - condition: template
      value_template: "{{ is_state('group.presence_home', 'home') }}"



action:

  # VOICE ALERT - sound alert notice using Intercom i.e. paging
  # -----------------------------------------------------------

  # a) Mute speaker volume if there is already audio playing
  - service: shell_command.speaker_volume_mute
  # Pause for a second - DO NOT REMOVE unless you have a fix!
  - delay: '00:00:01'

  # b) Chime alert using house speakers
  - service: shell_command.voice_alerts_and_sound_effects
    data_template:
      sound_alert: '1'
      audio_gain: !secret voice_alert_audio_gain

  # c) Internet off sound effect using house speakers
  #- service: shell_command.

  # d) Voice alert using house speakers
  - service: shell_command.voice_alerts_and_sound_effects
    data_template:
      sound_alert: '23'
      audio_gain: !secret voice_alert_audio_gain

  # e) Unmute speaker volume 
  - service: shell_command.speaker_volume_unmute 
