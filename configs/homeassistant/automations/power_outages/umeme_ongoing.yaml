# Power outages happening now - unplanned
alias: "Unplanned power outage on-going"
initial_state: True


trigger:

  - platform: state
    entity_id: sensor.power_outage_on_going


condition:
  condition: and
  conditions:

    # Internet state
    - condition: template
      value_template: "{{ is_state('binary_sensor.internet', 'on') }}"

    # Power outage state - ongoing
    - condition: template
      value_template: "{{ not is_state('sensor.power_outage_on_going', '') }}"


action:

  # Text power outage reports
  # -------------------------
  
    # a) WhatsApp
    - service: script.send_whatsapp
      data_template:        
        whatsapp_text: !include ../../templates/power_outages/umeme_ongoing_notification_message.yaml
        whatsapp_image: '/usr/share/JambulaTV/images/hass/power_outage_today.png'
        whatsapp_recipient_phone: ''

    # b) Telegram
    - service: script.send_telegram
      data_template: 
        telegram_text: !include ../../templates/power_outages/umeme_ongoing_notification_message.yaml
        telegram_image: '/usr/share/JambulaTV/images/hass/power_outage_today.png'
        telegram_recipient_phone: ''
