alias: Make some noise when motion is detected
initial_state: True


trigger:

  - platform: state
    entity_id: sensor.vision_security_zp3102_pir_motion_sensor_alarm_level
    to: '255'

#  - platform: state
#    entity_id: sensor.vision_security_zp3102_pir_motion_sensor_burglar
#    to: '8'


condition:
  condition: and
  conditions:

    # After sunrise
    #- condition: sun
      #after: sunset
      #before: sunrise
 
    # After HASS instance settles down after restart
    #- condition: template
     # value_template: "{{ states('sensor.hass_uptime.state')|int > '5' }}"


action:

  # Task 1 - Start capture of snapshot
  # -----------------------------------

  # Arm camera alarm
  - service: shell_command.zoneminder_camera_arm
    data_template:
      camera_id: !secret zoneminder_camera_001

  # Task 2 - sound alarm notice using Intercom i.e. paging
  # ------------------------------------------------------

  # a) Mute speaker volume if there is already audio playing
  - service: shell_command.speaker_volume_mute
  # Pause for a second - DO NOT REMOVE unless you have a fix!
  - delay: '00:00:01'

  # b) Chime alert using house speakers
  - service: shell_command.play_chime_alert

  # c) Voice alert using house speakers
  - service: shell_command.play_voice_alert

  # d) Unmute speaker volume 
  - service: shell_command.speaker_volume_unmute 

  # Task 3 - Stop capture of snapshot
  # ---------------------------------

  # a) Wait a bit
  - delay: '00:00:45'

  # b) Disarm camera alarm
  - service: shell_command.zoneminder_camera_disarm
    data_template:
      camera_id: !secret zoneminder_camera_001


  # Other examples
  # --------------
  # Make alarm at local server station
  #- service: shell_command.play_alert_at_local_server

    # Make noise - Beeps
  #- service: shell_command.play_alert_at_remote_workstation
  #  data_template:
  #    ssh_username: !secret operator_001_ssh_username
  #    ssh_host: !secret operator_001_ssh_host
  #    alert_command: "/usr/bin/aplay /usr/share/sounds/purple/alert.wav /usr/share/sounds/purple/alert.wav /usr/share/sounds/purple/alert.wav ; /usr/bin/gxmessage -center -ontop -sticky -timeout 20 -title Motion-detected Motion-detected-outside"
      # Try this alarm for loud noise
      #/usr/share/tuxtype/sounds/alarm.wav
