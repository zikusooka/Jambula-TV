alias: Eva is away
initial_state: True

trigger:

  - platform: state
    entity_id: person.eva
    to: 'Away'


condition:
  condition: and
  conditions:

    # Last triggered more than 5 minute(s) ago
    #- condition: template
      #value_template: '{{ (as_timestamp(now()) - as_timestamp(states.person.eva.attributes.last_triggered | default(0)) | int > 300)}}'

    # Last seen more than 10 minute(s) ago
    - condition: template
      value_template: '{{ ((sensor.last_seen_trackerjacker_eva_01 | default(0)) | int > 600)}}'

    # Not seen at all
    - condition: template
      value_template: '{{ ((sensor.last_seen_trackerjacker_eva_01 | default(0)) | int == 0)}}'

    # Laptop for Eva is turned off?
    #- condition: state
      #entity_id: 'device_tracker.eva'
      #state: 'Away'


action:

  - service: script.eva_is_away
