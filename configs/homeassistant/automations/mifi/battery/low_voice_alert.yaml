# Battery - Low (Voice Alert)
alias: "Play voice alert when MiFi battery is low"
initial_state: True


trigger:
  - platform: state
    entity_id: sensor.mifi_battery_level
    from: 'Warning'
    to: 'Critical'


#condition:
  #condition: and
  #conditions:

    # Internet state
    #- condition: template
      #value_template: "{{ is_state('binary_sensor.internet', 'on') }}"


action:

  # Task 1 - sound alert notice using Intercom i.e. paging
  # ------------------------------------------------------

  # a) Mute speaker volume if there is already audio playing
  - service: shell_command.speaker_volume_mute
  # Pause for a second - DO NOT REMOVE unless you have a fix!
  - delay: '00:00:01'

  # b) Battery low sound effect using house speakers
  - service: shell_command.voice_alerts_and_sound_effects
    data_template:
      sound_alert: '7'
      audio_gain: !secret voice_alert_audio_gain

  # c) Voice alert using house speakers
  - service: shell_command.voice_alerts_and_sound_effects
    data_template:
      sound_alert: '5'
      audio_gain: !secret voice_alert_audio_gain

  # d) Unmute speaker volume 
  - service: shell_command.speaker_volume_unmute 
