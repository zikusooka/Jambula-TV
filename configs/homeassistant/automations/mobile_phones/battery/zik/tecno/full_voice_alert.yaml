# Battery - Full (Voice Alert)
alias: "Play voice alert when phone battery for Zik (Tecno) is full"
initial_state: True


trigger:
  - platform: state
    entity_id: sensor.phone_battery_for_zik_tecno
    to: '100'


condition:
  condition: and
  conditions:


action:

  # a) Merge audio files
  - service: shell_command.ffmpeg_concat_two_mp3
    data_template:
      input_directory: !secret jambulatv_sounds_dir
      input_file1: 'phone_battery_charging_complete_for.mp3'
      input_file2: 'zik.mp3'
      output_directory: !secret jambulatv_temp_dir
      output_file: 'phone_battery_charging_completed_4_zik.mp3'

  # b) Mute speaker volume if there is already audio playing
  - service: shell_command.speaker_volume_mute
  # Pause for a second - DO NOT REMOVE unless you have a fix!
  - delay: '00:00:01'

  # c) Battery full sound effect using house speakers
  - service: shell_command.voice_alerts_and_sound_effects
    data_template:
      sound_alert: '8'
      audio_gain: !secret voice_alert_audio_gain

  # d) Play merged audio file using house speakers
  - service: shell_command.play_merged_audio_file
    data_template:
      merged_audio_dir: !secret jambulatv_temp_dir
      merged_audio_file: 'phone_battery_charging_completed_4_zik.mp3'

  # e) Unmute speaker volume 
  - service: shell_command.speaker_volume_unmute 
